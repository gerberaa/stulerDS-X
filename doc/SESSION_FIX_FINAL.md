# üîß –û—Å—Ç–∞—Ç–æ—á–Ω–µ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º–∏ –∑ —Å–µ—Å—ñ—è–º–∏

## üìã –ü—Ä–æ–±–ª–µ–º–∞

–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∞–≤—Ç–æ—Ä–∏–∑—É–≤–∞–≤—Å—è —á–µ—Ä–µ–∑ `/login`, –∞–ª–µ –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –∫–Ω–æ–ø–æ–∫ –º–µ–Ω—é (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, "–ú–æ—ó –ø—Ä–æ–µ–∫—Ç–∏") —Å–∏—Å—Ç–µ–º–∞ –∑–Ω–æ–≤—É –ø—Ä–æ—Å–∏–ª–∞ –ø–∞—Ä–æ–ª—å.

## ‚úÖ –†—ñ—à–µ–Ω–Ω—è

### 1Ô∏è‚É£ –ó–±—ñ–ª—å—à–µ–Ω–æ —á–∞—Å —Å–µ—Å—ñ—ó

**–ë—É–ª–æ:** 5 —Ö–≤–∏–ª–∏–Ω  
**–°—Ç–∞–ª–æ:** 30 —Ö–≤–∏–ª–∏–Ω

### 2Ô∏è‚É£ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ –ª–æ–≥—ñ–∫—É –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–µ—Å—ñ—ó

**–ë—É–ª–æ:** –°–µ—Å—ñ—è –æ–Ω–æ–≤–ª—é–≤–∞–ª–∞—Å—è –ø—Ä–∏ –∫–æ–∂–Ω—ñ–π –ø–µ—Ä–µ–≤—ñ—Ä—Ü—ñ `is_authorized()`  
**–°—Ç–∞–ª–æ:** –°–µ—Å—ñ—è –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –ø—Ä–∏ —Ä–µ–∞–ª—å–Ω—ñ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

### 3Ô∏è‚É£ –î–æ–¥–∞–Ω–æ –æ–∫—Ä–µ–º–∏–π –º–µ—Ç–æ–¥ –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ

```python
def update_session_activity(self, telegram_id: int) -> None:
    """–û–Ω–æ–≤–∏—Ç–∏ —á–∞—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ —Å–µ—Å—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞"""
    if telegram_id in self.authorized_users:
        self.user_sessions[telegram_id] = datetime.now()
        logger.debug(f"–û–Ω–æ–≤–ª–µ–Ω–æ –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å —Å–µ—Å—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ {telegram_id}")
```

### 4Ô∏è‚É£ –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –≤ –∫–ª—é—á–æ–≤–∏—Ö –º—ñ—Å—Ü—è—Ö

- ‚úÖ –ü—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –∫–Ω–æ–ø–æ–∫ –º–µ–Ω—é (`handle_callback_query`)
- ‚úÖ –ü—Ä–∏ —É—Å–ø—ñ—à–Ω—ñ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó (`handle_message`)
- ‚úÖ –ü—Ä–∏ –∫–æ–º–∞–Ω–¥—ñ `/login` (—è–∫—â–æ –≤–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–π)
- ‚úÖ –ü—Ä–∏ –∫–æ–º–∞–Ω–¥—ñ `/start` (—è–∫—â–æ –≤–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–π)

## üîß –¢–µ—Ö–Ω—ñ—á–Ω—ñ –∑–º—ñ–Ω–∏

### `access_manager.py`

```python
# –ó–±—ñ–ª—å—à–µ–Ω–æ —á–∞—Å —Å–µ—Å—ñ—ó
"session_timeout_minutes": 30,  # –∑–∞–º—ñ—Å—Ç—å 5

# –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ –ª–æ–≥—ñ–∫—É –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏
def is_authorized(self, telegram_id: int) -> bool:
    # –¢—ñ–ª—å–∫–∏ –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, –Ω–µ –æ–Ω–æ–≤–ª—é—î–º–æ
    if telegram_id in self.user_sessions:
        session_timeout = timedelta(minutes=self.data["settings"]["session_timeout_minutes"])
        if datetime.now() - self.user_sessions[telegram_id] > session_timeout:
            self.logout_user(telegram_id)
            return False
    return True

# –î–æ–¥–∞–Ω–æ –æ–∫—Ä–µ–º–∏–π –º–µ—Ç–æ–¥ –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
def update_session_activity(self, telegram_id: int) -> None:
    if telegram_id in self.authorized_users:
        self.user_sessions[telegram_id] = datetime.now()
```

### `bot.py`

```python
# –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –∫–Ω–æ–ø–æ–∫
async def handle_callback_query(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    if not access_manager.is_authorized(user_id):
        # –ü–æ–∫–∞–∑–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –∑–∞–∫—ñ–Ω—á–µ–Ω–Ω—è —Å–µ—Å—ñ—ó
        return
    
    # –û–Ω–æ–≤–ª—é—î–º–æ –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
    access_manager.update_session_activity(user_id)

# –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –ø—Ä–∏ —É—Å–ø—ñ—à–Ω—ñ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
if access_manager.authenticate_user(user_id, message_text):
    access_manager.update_session_activity(user_id)
```

### `access_data.json`

```json
{
  "settings": {
    "session_timeout_minutes": 30,  // –∑–∞–º—ñ—Å—Ç—å 5
    "max_login_attempts": 3
  }
}
```

## üéØ –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î —Ç–µ–ø–µ—Ä

### ‚úÖ –°—Ü–µ–Ω–∞—Ä—ñ–π 1: –ù–æ—Ä–º–∞–ª—å–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è
1. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á: `/login` ‚Üí –≤–≤–æ–¥–∏—Ç—å –ø–∞—Ä–æ–ª—å
2. –°–∏—Å—Ç–µ–º–∞: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è —É—Å–ø—ñ—à–Ω–∞ ‚Üí –æ–Ω–æ–≤–ª—é—î –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å —Å–µ—Å—ñ—ó
3. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á: –ù–∞—Ç–∏—Å–∫–∞—î "–ú–æ—ó –ø—Ä–æ–µ–∫—Ç–∏"
4. –°–∏—Å—Ç–µ–º–∞: –ü–µ—Ä–µ–≤—ñ—Ä—è—î –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é ‚Üí –æ–Ω–æ–≤–ª—é—î –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å —Å–µ—Å—ñ—ó
5. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á: –ü—Ä–æ–¥–æ–≤–∂—É—î –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –±–æ—Ç–∞ ‚Üí —Å–µ—Å—ñ—è –ø—Ä–æ–¥–æ–≤–∂—É—î—Ç—å—Å—è

### ‚úÖ –°—Ü–µ–Ω–∞—Ä—ñ–π 2: –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Å–µ—Å—ñ—ó
1. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á: –ê–≤—Ç–æ—Ä–∏–∑—É—î—Ç—å—Å—è
2. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á: –ù–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –±–æ—Ç–∞ 30 —Ö–≤–∏–ª–∏–Ω
3. –°–∏—Å—Ç–µ–º–∞: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–≤–µ—Ä—à—É—î —Å–µ—Å—ñ—é
4. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á: –ù–∞—Ç–∏—Å–∫–∞—î –∫–Ω–æ–ø–∫—É ‚Üí –ø–æ—Ç—Ä—ñ–±–Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è

## üìä –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –î–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è | –ü—ñ—Å–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è |
|----------|----------------|-------------------|
| –ß–∞—Å —Å–µ—Å—ñ—ó | 5 —Ö–≤–∏–ª–∏–Ω | 30 —Ö–≤–∏–ª–∏–Ω |
| –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–µ—Å—ñ—ó | –ü—Ä–∏ –∫–æ–∂–Ω—ñ–π –ø–µ—Ä–µ–≤—ñ—Ä—Ü—ñ | –ü—Ä–∏ —Ä–µ–∞–ª—å–Ω—ñ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ |
| –û—á–∏—â–µ–Ω–Ω—è —Å–µ—Å—ñ–π | –ö–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω | –ö–æ–∂–Ω—ñ 30 —Ö–≤–∏–ª–∏–Ω |
| –°—Ç–∞–±—ñ–ª—å–Ω—ñ—Å—Ç—å | –ù–µ—Å—Ç–∞–±—ñ–ª—å–Ω–∞ | –°—Ç–∞–±—ñ–ª—å–Ω–∞ |

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ **–ü—Ä–æ–±–ª–µ–º–∞ –≤–∏—Ä—ñ—à–µ–Ω–∞:** –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ —Å–ø–æ–∫—ñ–π–Ω–æ –Ω–∞—Ç–∏—Å–∫–∞—Ç–∏ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é  
‚úÖ **–°—Ç–∞–±—ñ–ª—å–Ω—ñ—Å—Ç—å:** –°–µ—Å—ñ—è –Ω–µ –∑–∞–∫—ñ–Ω—á—É—î—Ç—å—Å—è –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º—É –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ  
‚úÖ **–ë–µ–∑–ø–µ–∫–∞:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —á–µ—Ä–µ–∑ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å  
‚úÖ **–ó—Ä—É—á–Ω—ñ—Å—Ç—å:** 30 —Ö–≤–∏–ª–∏–Ω –¥–æ—Å—Ç–∞—Ç–Ω—å–æ –¥–ª—è –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ—ó —Ä–æ–±–æ—Ç–∏  

–¢–µ–ø–µ—Ä —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–∞—Ü—é—î –ø—Ä–∞–≤–∏–ª—å–Ω–æ: –∞–≤—Ç–æ—Ä–∏–∑—É–≤–∞–≤—Å—è –æ–¥–∏–Ω —Ä–∞–∑ ‚Üí –º–æ–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –±–æ—Ç–∞ 30 —Ö–≤–∏–ª–∏–Ω –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ—ó –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó! üöÄ