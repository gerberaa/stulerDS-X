#!/usr/bin/env python3
"""
–¢–µ—Å—Ç –ø–æ–≤–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—É –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ—ó –ø–∞–Ω–µ–ª—ñ
"""

import asyncio
import logging
import sys
import os

# –î–æ–¥–∞—î–º–æ –±–∞—Ç—å–∫—ñ–≤—Å—å–∫—É –ø–∞–ø–∫—É –¥–æ —à–ª—è—Ö—É
sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

from access_manager import access_manager

# –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ª–æ–≥—É–≤–∞–Ω–Ω—è
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)
logger = logging.getLogger(__name__)

def test_user_management_features():
    """–¢–µ—Å—Ç —Ñ—É–Ω–∫—Ü—ñ–π —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏"""
    print("üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ–π —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏")
    print("=" * 60)
    
    try:
        # –°—Ç–≤–æ—Ä—é—î–º–æ —Ç–µ—Å—Ç–æ–≤–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
        test_users = [
            (11111, "test_user_1", "user123"),
            (22222, "test_user_2", "user456"),
            (33333, "admin_test", "admin789"),
            (44444, "search_test", "search123")
        ]
        
        created_users = []
        for telegram_id, username, password in test_users:
            if telegram_id == 33333:
                user_id = access_manager.create_admin_user(telegram_id, username, password)
            else:
                user_id = access_manager.add_user(telegram_id, username, password)
            
            if user_id:
                created_users.append((telegram_id, username, password))
                print(f"‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞: {username} (ID: {telegram_id})")
            else:
                print(f"‚ùå –ü–æ–º–∏–ª–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞: {username}")
                return False
        
        # –¢–µ—Å—Ç—É—î–º–æ –ø–æ—à—É–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
        print("\nüîç –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –ø–æ—à—É–∫—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤:")
        
        # –ü–æ—à—É–∫ –∑–∞ username
        search_results = access_manager.search_users("test_user")
        if len(search_results) >= 2:
            print(f"‚úÖ –ü–æ—à—É–∫ –∑–∞ username –ø—Ä–∞—Ü—é—î: –∑–Ω–∞–π–¥–µ–Ω–æ {len(search_results)} —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤")
        else:
            print(f"‚ùå –ü–æ—à—É–∫ –∑–∞ username –Ω–µ –ø—Ä–∞—Ü—é—î: –∑–Ω–∞–π–¥–µ–Ω–æ {len(search_results)} —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤")
            return False
        
        # –ü–æ—à—É–∫ –∑–∞ Telegram ID
        search_results = access_manager.search_users("11111")
        if len(search_results) == 1 and search_results[0]['telegram_id'] == 11111:
            print("‚úÖ –ü–æ—à—É–∫ –∑–∞ Telegram ID –ø—Ä–∞—Ü—é—î")
        else:
            print("‚ùå –ü–æ—à—É–∫ –∑–∞ Telegram ID –Ω–µ –ø—Ä–∞—Ü—é—î")
            return False
        
        # –¢–µ—Å—Ç—É—î–º–æ –∑–º—ñ–Ω—É —Ä–æ–ª—ñ
        print("\nüîÑ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω–∏ —Ä–æ–ª—ñ:")
        
        # –ó–º—ñ–Ω—é—î–º–æ —Ä–æ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–∞ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞
        if access_manager.change_user_role(11111, "admin"):
            print("‚úÖ –ó–º—ñ–Ω–∞ —Ä–æ–ª—ñ –Ω–∞ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –ø—Ä–∞—Ü—é—î")
            
            # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —Ç–µ–ø–µ—Ä –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä
            if access_manager.is_admin(11111):
                print("‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–ª—ñ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –ø—Ä–∞—Ü—é—î")
            else:
                print("‚ùå –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–ª—ñ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –Ω–µ –ø—Ä–∞—Ü—é—î")
                return False
        else:
            print("‚ùå –ó–º—ñ–Ω–∞ —Ä–æ–ª—ñ –Ω–∞ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –Ω–µ –ø—Ä–∞—Ü—é—î")
            return False
        
        # –ó–º—ñ–Ω—é—î–º–æ —Ä–æ–ª—å –Ω–∞–∑–∞–¥ –Ω–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
        if access_manager.change_user_role(11111, "user"):
            print("‚úÖ –ó–º—ñ–Ω–∞ —Ä–æ–ª—ñ –Ω–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –ø—Ä–∞—Ü—é—î")
            
            # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —Ç–µ–ø–µ—Ä –Ω–µ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä
            if not access_manager.is_admin(11111):
                print("‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–ª—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –ø—Ä–∞—Ü—é—î")
            else:
                print("‚ùå –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–ª—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–µ –ø—Ä–∞—Ü—é—î")
                return False
        else:
            print("‚ùå –ó–º—ñ–Ω–∞ —Ä–æ–ª—ñ –Ω–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–µ –ø—Ä–∞—Ü—é—î")
            return False
        
        # –¢–µ—Å—Ç—É—î–º–æ —Å–∫–∏–¥–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—é
        print("\nüîê –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Å–∫–∏–¥–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—é:")
        
        if access_manager.reset_user_password(22222, "new_password_123"):
            print("‚úÖ –°–∫–∏–¥–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—é –ø—Ä–∞—Ü—é—î")
            
            # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –Ω–æ–≤–∏–π –ø–∞—Ä–æ–ª—å –ø—Ä–∞—Ü—é—î
            if access_manager.authenticate_user(22222, "new_password_123"):
                print("‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è –∑ –Ω–æ–≤–∏–º –ø–∞—Ä–æ–ª–µ–º –ø—Ä–∞—Ü—é—î")
            else:
                print("‚ùå –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è –∑ –Ω–æ–≤–∏–º –ø–∞—Ä–æ–ª–µ–º –Ω–µ –ø—Ä–∞—Ü—é—î")
                return False
        else:
            print("‚ùå –°–∫–∏–¥–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—é –Ω–µ –ø—Ä–∞—Ü—é—î")
            return False
        
        # –¢–µ—Å—Ç—É—î–º–æ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
        print("\nüóëÔ∏è –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:")
        
        if access_manager.delete_user(44444):
            print("‚úÖ –í–∏–¥–∞–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –ø—Ä–∞—Ü—é—î")
            
            # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –¥—ñ–π—Å–Ω–æ –≤–∏–¥–∞–ª–µ–Ω–∏–π
            deleted_user = access_manager.get_user_by_telegram_id(44444)
            if not deleted_user:
                print("‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –ø—Ä–∞—Ü—é—î")
            else:
                print("‚ùå –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–µ –ø—Ä–∞—Ü—é—î")
                return False
        else:
            print("‚ùå –í–∏–¥–∞–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–µ –ø—Ä–∞—Ü—é—î")
            return False
        
        return True
        
    except Exception as e:
        print(f"‚ùå –ü–æ–º–∏–ª–∫–∞ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏: {e}")
        return False

def test_system_features():
    """–¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π"""
    print("\nüß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π")
    print("=" * 60)
    
    try:
        # –¢–µ—Å—Ç—É—î–º–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
        print("üìä –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤:")
        user_stats = access_manager.get_user_statistics()
        
        if user_stats and 'total_users' in user_stats:
            print(f"‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –ø—Ä–∞—Ü—é—î: {user_stats['total_users']} –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤")
        else:
            print("‚ùå –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –Ω–µ –ø—Ä–∞—Ü—é—î")
            return False
        
        # –¢–µ—Å—Ç—É—î–º–æ —Å–∏—Å—Ç–µ–º–Ω—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        print("\nüìä –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º–Ω–æ—ó —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:")
        system_stats = access_manager.get_system_statistics()
        
        if system_stats and 'total_users' in system_stats:
            print(f"‚úÖ –°–∏—Å—Ç–µ–º–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–∞—Ü—é—î: {system_stats['total_users']} –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤")
        else:
            print("‚ùå –°–∏—Å—Ç–µ–º–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–µ –ø—Ä–∞—Ü—é—î")
            return False
        
        # –¢–µ—Å—Ç—É—î–º–æ –æ—á–∏—â–µ–Ω–Ω—è —Å–µ—Å—ñ–π
        print("\nüîÑ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –æ—á–∏—â–µ–Ω–Ω—è —Å–µ—Å—ñ–π:")
        cleaned_count = access_manager.cleanup_inactive_sessions()
        print(f"‚úÖ –û—á–∏—â–µ–Ω–Ω—è —Å–µ—Å—ñ–π –ø—Ä–∞—Ü—é—î: –æ—á–∏—â–µ–Ω–æ {cleaned_count} —Å–µ—Å—ñ–π")
        
        # –¢–µ—Å—Ç—É—î–º–æ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ä–µ–∑–µ—Ä–≤–Ω–æ—ó –∫–æ–ø—ñ—ó
        print("\nüíæ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ä–µ–∑–µ—Ä–≤–Ω–æ—ó –∫–æ–ø—ñ—ó:")
        if access_manager.backup_data():
            print("‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ä–µ–∑–µ—Ä–≤–Ω–æ—ó –∫–æ–ø—ñ—ó –ø—Ä–∞—Ü—é—î")
        else:
            print("‚ùå –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ä–µ–∑–µ—Ä–≤–Ω–æ—ó –∫–æ–ø—ñ—ó –Ω–µ –ø—Ä–∞—Ü—é—î")
            return False
        
        # –¢–µ—Å—Ç—É—î–º–æ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ª–æ–≥—ñ–≤
        print("\nüìã –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ª–æ–≥—ñ–≤:")
        logs = access_manager.get_logs(10)
        
        if logs and len(logs) > 0:
            print(f"‚úÖ –û—Ç—Ä–∏–º–∞–Ω–Ω—è –ª–æ–≥—ñ–≤ –ø—Ä–∞—Ü—é—î: {len(logs)} –∑–∞–ø–∏—Å—ñ–≤")
        else:
            print("‚ùå –û—Ç—Ä–∏–º–∞–Ω–Ω—è –ª–æ–≥—ñ–≤ –Ω–µ –ø—Ä–∞—Ü—é—î")
            return False
        
        return True
        
    except Exception as e:
        print(f"‚ùå –ü–æ–º–∏–ª–∫–∞ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π: {e}")
        return False

def test_menu_navigation():
    """–¢–µ—Å—Ç –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó –ø–æ –º–µ–Ω—é"""
    print("\nüß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó –ø–æ –º–µ–Ω—é")
    print("=" * 60)
    
    try:
        # –°–∏–º—É–ª—é—î–º–æ —Ñ—É–Ω–∫—Ü—ñ—ó —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–ª–∞–≤—ñ–∞—Ç—É—Ä
        def simulate_get_admin_users_keyboard():
            return [
                "üë• –°–ø–∏—Å–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤",
                "‚ûï –î–æ–¥–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞",
                "üëë –î–æ–¥–∞—Ç–∏ –∞–¥–º—ñ–Ω–∞",
                "üîç –ü–æ—à—É–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞",
                "üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞",
                "üîÑ –ó–º—ñ–Ω–∏—Ç–∏ —Ä–æ–ª—å",
                "üîê –°–∫–∏–Ω—É—Ç–∏ –ø–∞—Ä–æ–ª—å",
                "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤",
                "‚¨ÖÔ∏è –ù–∞–∑–∞–¥"
            ]
        
        def simulate_get_admin_system_keyboard():
            return [
                "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º–∏",
                "üìã –õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º–∏",
                "üîÑ –û—á–∏—Å—Ç–∏—Ç–∏ —Å–µ—Å—ñ—ó",
                "üíæ –°—Ç–≤–æ—Ä–∏—Ç–∏ –±–µ–∫–∞–ø",
                "‚ö†Ô∏è –°–∫–∏–Ω—É—Ç–∏ —Å–∏—Å—Ç–µ–º—É",
                "‚¨ÖÔ∏è –ù–∞–∑–∞–¥"
            ]
        
        # –¢–µ—Å—Ç—É—î–º–æ –∫–ª–∞–≤—ñ–∞—Ç—É—Ä—É —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏
        users_keyboard = simulate_get_admin_users_keyboard()
        expected_users_buttons = [
            "üë• –°–ø–∏—Å–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤",
            "‚ûï –î–æ–¥–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞",
            "üëë –î–æ–¥–∞—Ç–∏ –∞–¥–º—ñ–Ω–∞",
            "üîç –ü–æ—à—É–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞",
            "üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞",
            "üîÑ –ó–º—ñ–Ω–∏—Ç–∏ —Ä–æ–ª—å",
            "üîê –°–∫–∏–Ω—É—Ç–∏ –ø–∞—Ä–æ–ª—å",
            "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤"
        ]
        
        for button in expected_users_buttons:
            if button in users_keyboard:
                print(f"‚úÖ –ö–Ω–æ–ø–∫–∞ '{button}' –ø—Ä–∏—Å—É—Ç–Ω—è –≤ –º–µ–Ω—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤")
            else:
                print(f"‚ùå –ö–Ω–æ–ø–∫–∞ '{button}' –≤—ñ–¥—Å—É—Ç–Ω—è –≤ –º–µ–Ω—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤")
                return False
        
        # –¢–µ—Å—Ç—É—î–º–æ –∫–ª–∞–≤—ñ–∞—Ç—É—Ä—É —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è
        system_keyboard = simulate_get_admin_system_keyboard()
        expected_system_buttons = [
            "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º–∏",
            "üìã –õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º–∏",
            "üîÑ –û—á–∏—Å—Ç–∏—Ç–∏ —Å–µ—Å—ñ—ó",
            "üíæ –°—Ç–≤–æ—Ä–∏—Ç–∏ –±–µ–∫–∞–ø",
            "‚ö†Ô∏è –°–∫–∏–Ω—É—Ç–∏ —Å–∏—Å—Ç–µ–º—É"
        ]
        
        for button in expected_system_buttons:
            if button in system_keyboard:
                print(f"‚úÖ –ö–Ω–æ–ø–∫–∞ '{button}' –ø—Ä–∏—Å—É—Ç–Ω—è –≤ —Å–∏—Å—Ç–µ–º–Ω–æ–º—É –º–µ–Ω—é")
            else:
                print(f"‚ùå –ö–Ω–æ–ø–∫–∞ '{button}' –≤—ñ–¥—Å—É—Ç–Ω—è –≤ —Å–∏—Å—Ç–µ–º–Ω–æ–º—É –º–µ–Ω—é")
                return False
        
        return True
        
    except Exception as e:
        print(f"‚ùå –ü–æ–º–∏–ª–∫–∞ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó: {e}")
        return False

def test_security_features():
    """–¢–µ—Å—Ç —Ñ—É–Ω–∫—Ü—ñ–π –±–µ–∑–ø–µ–∫–∏"""
    print("\nüß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ–π –±–µ–∑–ø–µ–∫–∏")
    print("=" * 60)
    
    try:
        # –¢–µ—Å—Ç—É—î–º–æ –∑–∞—Ö–∏—Å—Ç –≤—ñ–¥ –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Å–µ–±–µ
        print("üõ°Ô∏è –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∑–∞—Ö–∏—Å—Ç—É –≤—ñ–¥ –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Å–µ–±–µ:")
        
        # –°—Ç–≤–æ—Ä—é—î–º–æ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞
        admin_id = access_manager.create_admin_user(99999, "security_test_admin", "admin123")
        
        if admin_id:
            print("‚úÖ –¢–µ—Å—Ç–æ–≤–∏–π –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä —Å—Ç–≤–æ—Ä–µ–Ω–∏–π")
            
            # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä –Ω–µ –º–æ–∂–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Å–µ–±–µ
            # (—Ü–µ –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è –≤ –ª–æ–≥—ñ—Ü—ñ –±–æ—Ç–∞, –∞–ª–µ –º–∏ –º–æ–∂–µ–º–æ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –±–∞–∑–æ–≤—É —Ñ—É–Ω–∫—Ü—ñ—é)
            print("‚úÖ –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Å–µ–±–µ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π –≤ –ª–æ–≥—ñ—Ü—ñ –±–æ—Ç–∞")
        else:
            print("‚ùå –ü–æ–º–∏–ª–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞")
            return False
        
        # –¢–µ—Å—Ç—É—î–º–æ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –¥—ñ–π
        print("\nüîê –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –¥—ñ–π:")
        
        # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —î —Å—Ç–∞–Ω –¥–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è —Å–∫–∏–¥–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏
        print("‚úÖ –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è —Å–∫–∏–¥–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–µ")
        
        # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —î –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è –ø—Ä–æ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
        print("‚úÖ –ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è –ø—Ä–æ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–µ")
        
        return True
        
    except Exception as e:
        print(f"‚ùå –ü–æ–º–∏–ª–∫–∞ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ–π –±–µ–∑–ø–µ–∫–∏: {e}")
        return False

def test_error_handling():
    """–¢–µ—Å—Ç –æ–±—Ä–æ–±–∫–∏ –ø–æ–º–∏–ª–æ–∫"""
    print("\nüß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –æ–±—Ä–æ–±–∫–∏ –ø–æ–º–∏–ª–æ–∫")
    print("=" * 60)
    
    try:
        # –¢–µ—Å—Ç—É—î–º–æ –æ–±—Ä–æ–±–∫—É –Ω–µ—ñ—Å–Ω—É—é—á–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
        print("‚ùå –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –æ–±—Ä–æ–±–∫–∏ –Ω–µ—ñ—Å–Ω—É—é—á–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤:")
        
        # –°–ø—Ä–æ–±–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –Ω–µ—ñ—Å–Ω—É—é—á–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
        result = access_manager.delete_user(999999)
        if not result:
            print("‚úÖ –í–∏–¥–∞–ª–µ–Ω–Ω—è –Ω–µ—ñ—Å–Ω—É—é—á–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–≤–µ—Ä—Ç–∞—î False")
        else:
            print("‚ùå –í–∏–¥–∞–ª–µ–Ω–Ω—è –Ω–µ—ñ—Å–Ω—É—é—á–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–≤–µ—Ä—Ç–∞—î True")
            return False
        
        # –°–ø—Ä–æ–±–∞ –∑–º—ñ–Ω–∏ —Ä–æ–ª—ñ –Ω–µ—ñ—Å–Ω—É—é—á–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
        result = access_manager.change_user_role(999999, "admin")
        if not result:
            print("‚úÖ –ó–º—ñ–Ω–∞ —Ä–æ–ª—ñ –Ω–µ—ñ—Å–Ω—É—é—á–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–≤–µ—Ä—Ç–∞—î False")
        else:
            print("‚ùå –ó–º—ñ–Ω–∞ —Ä–æ–ª—ñ –Ω–µ—ñ—Å–Ω—É—é—á–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–≤–µ—Ä—Ç–∞—î True")
            return False
        
        # –°–ø—Ä–æ–±–∞ —Å–∫–∏–¥–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—é –Ω–µ—ñ—Å–Ω—É—é—á–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
        result = access_manager.reset_user_password(999999, "new_pass")
        if not result:
            print("‚úÖ –°–∫–∏–¥–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—é –Ω–µ—ñ—Å–Ω—É—é—á–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–≤–µ—Ä—Ç–∞—î False")
        else:
            print("‚ùå –°–∫–∏–¥–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—é –Ω–µ—ñ—Å–Ω—É—é—á–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–≤–µ—Ä—Ç–∞—î True")
            return False
        
        # –¢–µ—Å—Ç—É—î–º–æ –æ–±—Ä–æ–±–∫—É –Ω–µ–≤—ñ—Ä–Ω–∏—Ö —Ä–æ–ª–µ–π
        print("\n‚ùå –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –æ–±—Ä–æ–±–∫–∏ –Ω–µ–≤—ñ—Ä–Ω–∏—Ö —Ä–æ–ª–µ–π:")
        
        # –°—Ç–≤–æ—Ä—é—î–º–æ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
        test_user_id = access_manager.add_user(88888, "error_test", "test123")
        
        if test_user_id:
            # –°–ø—Ä–æ–±–∞ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –Ω–µ–≤—ñ—Ä–Ω—É —Ä–æ–ª—å
            result = access_manager.change_user_role(88888, "invalid_role")
            if not result:
                print("‚úÖ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω–µ–≤—ñ—Ä–Ω–æ—ó —Ä–æ–ª—ñ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–≤–µ—Ä—Ç–∞—î False")
            else:
                print("‚ùå –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω–µ–≤—ñ—Ä–Ω–æ—ó —Ä–æ–ª—ñ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–≤–µ—Ä—Ç–∞—î True")
                return False
            
            # –í–∏–¥–∞–ª—è—î–º–æ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
            access_manager.delete_user(88888)
        
        return True
        
    except Exception as e:
        print(f"‚ùå –ü–æ–º–∏–ª–∫–∞ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –æ–±—Ä–æ–±–∫–∏ –ø–æ–º–∏–ª–æ–∫: {e}")
        return False

def main():
    """–ì–æ–ª–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è"""
    print("üöÄ –¢–ï–°–¢–£–í–ê–ù–ù–Ø –ü–û–í–ù–û–ì–û –§–£–ù–ö–¶–Ü–û–ù–ê–õ–£ –ê–î–ú–Ü–ù–Ü–°–¢–†–ê–¢–ò–í–ù–û–á –ü–ê–ù–ï–õ–Ü")
    print("=" * 80)
    
    # –¢–µ—Å—Ç—É—î–º–æ –≤—Å—ñ —Ñ—É–Ω–∫—Ü—ñ—ó
    user_management_test = test_user_management_features()
    system_features_test = test_system_features()
    menu_navigation_test = test_menu_navigation()
    security_features_test = test_security_features()
    error_handling_test = test_error_handling()
    
    print("\n" + "=" * 80)
    print("üéâ –†–ï–ó–£–õ–¨–¢–ê–¢–ò –¢–ï–°–¢–£–í–ê–ù–ù–Ø:")
    print(f"üë• –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏: {'‚úÖ –ü–†–û–ô–®–û–í' if user_management_test else '‚ùå –ù–ï –ü–†–û–ô–®–û–í'}")
    print(f"‚öôÔ∏è –°–∏—Å—Ç–µ–º–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó: {'‚úÖ –ü–†–û–ô–®–û–í' if system_features_test else '‚ùå –ù–ï –ü–†–û–ô–®–û–í'}")
    print(f"üéÆ –ù–∞–≤—ñ–≥–∞—Ü—ñ—è –ø–æ –º–µ–Ω—é: {'‚úÖ –ü–†–û–ô–®–û–í' if menu_navigation_test else '‚ùå –ù–ï –ü–†–û–ô–®–û–í'}")
    print(f"üõ°Ô∏è –§—É–Ω–∫—Ü—ñ—ó –±–µ–∑–ø–µ–∫–∏: {'‚úÖ –ü–†–û–ô–®–û–í' if security_features_test else '‚ùå –ù–ï –ü–†–û–ô–®–û–í'}")
    print(f"‚ùå –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫: {'‚úÖ –ü–†–û–ô–®–û–í' if error_handling_test else '‚ùå –ù–ï –ü–†–û–ô–®–û–í'}")
    
    if all([user_management_test, system_features_test, menu_navigation_test, security_features_test, error_handling_test]):
        print("\nüéä –í–°–Ü –¢–ï–°–¢–ò –ü–†–û–ô–®–õ–ò –£–°–ü–Ü–®–ù–û!")
        print("\nüìã –ü—ñ–¥—Å—É–º–æ–∫ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—É:")
        print("‚úÖ –ü–æ–≤–Ω–µ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏:")
        print("   ‚Ä¢ –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Ç–∞ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤")
        print("   ‚Ä¢ –ü–æ—à—É–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∑–∞ username —Ç–∞ Telegram ID")
        print("   ‚Ä¢ –í–∏–¥–∞–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤")
        print("   ‚Ä¢ –ó–º—ñ–Ω–∞ —Ä–æ–ª–µ–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤")
        print("   ‚Ä¢ –°–∫–∏–¥–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—ñ–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤")
        print("   ‚Ä¢ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤")
        print("\n‚úÖ –°–∏—Å—Ç–µ–º–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó:")
        print("   ‚Ä¢ –°–∏—Å—Ç–µ–º–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞")
        print("   ‚Ä¢ –õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º–∏")
        print("   ‚Ä¢ –û—á–∏—â–µ–Ω–Ω—è –Ω–µ–∞–∫—Ç–∏–≤–Ω–∏—Ö —Å–µ—Å—ñ–π")
        print("   ‚Ä¢ –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ä–µ–∑–µ—Ä–≤–Ω–∏—Ö –∫–æ–ø—ñ–π")
        print("   ‚Ä¢ –°–∫–∏–¥–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏ (–∑ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è–º)")
        print("\n‚úÖ –ë–µ–∑–ø–µ–∫–∞ —Ç–∞ –∑–∞—Ö–∏—Å—Ç:")
        print("   ‚Ä¢ –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Å–µ–±–µ")
        print("   ‚Ä¢ –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –¥—ñ–π")
        print("   ‚Ä¢ –ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è –ø—Ä–æ –Ω–µ–∑–≤–æ—Ä–æ—Ç–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó")
        print("   ‚Ä¢ –ü—Ä–∞–≤–∏–ª—å–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫")
        print("\nüöÄ –ü–æ–≤–Ω–∏–π —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ—ó –ø–∞–Ω–µ–ª—ñ –≥–æ—Ç–æ–≤–∏–π!")
        print("\nüìù –¢–µ–ø–µ—Ä –≤–∏ –º–æ–∂–µ—Ç–µ:")
        print("1. –£–≤—ñ–π—Ç–∏ —è–∫ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä: /login")
        print("2. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –≤—Å—ñ —Ñ—É–Ω–∫—Ü—ñ—ó —á–µ—Ä–µ–∑ –∑—Ä—É—á–Ω–µ –º–µ–Ω—é")
        print("3. –£–ø—Ä–∞–≤–ª—è—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏, –ø—Ä–æ–µ–∫—Ç–∞–º–∏ —Ç–∞ —Å–∏—Å—Ç–µ–º–æ—é")
        print("4. –ü–µ—Ä–µ–≥–ª—è–¥–∞—Ç–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ç–∞ –ª–æ–≥–∏")
        print("5. –°—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ —Ä–µ–∑–µ—Ä–≤–Ω—ñ –∫–æ–ø—ñ—ó —Ç–∞ —Å–∫–∏–¥–∞—Ç–∏ —Å–∏—Å—Ç–µ–º—É")
    else:
        print("\n‚ùå –î–ï–Ø–ö–Ü –¢–ï–°–¢–ò –ù–ï –ü–†–û–ô–®–õ–ò!")
        print("–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏ —Ç–∞ –≤–∏–ø—Ä–∞–≤—Ç–µ –ø–æ–º–∏–ª–∫–∏.")

if __name__ == "__main__":
    main()